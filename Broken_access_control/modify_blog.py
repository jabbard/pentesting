import requests

# Replace these values with your own
BWAPP_URL = "http://10.0.2.5/bWAPP"
USERNAME = "bee"
PASSWORD = "bug"
NEW_ENTRY = "This is an unauthorized modification."

session = requests.Session()

def login():
    login_url = f"{BWAPP_URL}/login.php"
    data = {
        'login': USERNAME,
        'password': PASSWORD,
        'form': 'submit'
    }
    try:
        response = session.post(login_url, data=data, timeout=10)
        if response.status_code == 200 and ("Welcome" in response.text or "Logout" in response.text):
            print("[+] Logged in successfully.")
            return True
        else:
            print("[-] Failed to log in.")
            return False
    except requests.exceptions.RequestException as e:
        print(f"[-] Login request failed: {e}")
        return False

def add_blog_entry(new_entry):
    add_entry_url = f"{BWAPP_URL}/xss_stored_1.php"
    data = {
        'entry': new_entry,
        'entry_add': 'on',
        'form': 'submit'
    }
    try:
        response = session.post(add_entry_url, data=data, timeout=10)
        if response.status_code == 200 and "Your entry was added" in response.text:
            print("[+] Blog entry added successfully.")
        else:
            print(f"[-] Failed to add blog entry. Status code: {response.status_code}")
    except requests.exceptions.RequestException as e:
        print(f"[-] Request to add blog entry failed: {e}")

if __name__ == "__main__":
    if login():
        add_blog_entry(new_entry=NEW_ENTRY)
    else:
        print("[-] Exiting script due to failed login.")
